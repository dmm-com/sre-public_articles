## はじめに
この記事は DMMグループ Advent Calendar 2023 のxx日目の記事です。

こんにちは、SRE部の○○です。
SRE部では、サイトの信頼性向上に寄与するような活動を全社横断で行なっています。

その中で今回は、社内の各種サービスの稼働状態を可視化する仕組み（以下、Internal Status Page）を社内に公開しましたので、
そのお話をしたいと思います。

## なんでもやってるDMM
「領域問わずなんでもやる」を弊社では掲げていますが、文字通りなんでもやっている会社です。
当記事の執筆時点では、サービスは60事業以上におよびます。

さらにこの60事業というのは、あくまで社外に公開しているサービスだけですので、
社内でのみ利用されるサービスも含めると、数はさらに多くなります。

## なぜ Internal Status Pageを作ろうと思ったのか
弊社では数多くのサービスがシステムとして稼働していますが、
サービス提供元となっている各事業部が、それぞれでシステムの監視を行なっています。

そのためサービス単体で見ると、稼働状況が把握できているため、大きな問題はありません。

自身の事業部のサービスだけに閉じた話であれば、それでよいのですが、弊社の場合だと、


社内共通の認証サービスや、会員サービスのAPIを利用している
共通系以外でも、個別のサービスのAPIを呼んでいる（たとえばサービスAがサービスBのAPIを利用している）
といったことがあり、社内の他サービスの稼働状況を知りたいといったケースが多々あります。
また、これらについてサービス提供元に問い合わせたいと思っても、問い合わせ先を調べる必要が出てきます。

社内サービスの稼働状況や、それに紐づく問い合わせ先などを俯瞰的に、
一括で見られるものがなかったという課題があったのです。

## Internal Status Pageについて

### システム構成イメージ

Internal Status Page のシステム構成イメージは以下のとおりです。

![Internal Status Page](img/system_overview.png)

### システム構成についての概要説明

Internal Status Page では主に以下のサービスを利用しています

- Status Page
- PagerDuty
- 事業部ごとに利用している監視ツール
  - Datadog
  - NewRelic
  - StatusCake
  - ...etc

上記のそれぞれの役割は以下のとおりです。

| ツール   | 役割 |
| :--------- | :--- |
| Status Page    | XXX |
| PagerDuty   | XXX |
| 事業部ごとの監視ツール | XXX |


### 障害時のInternal Status Pageの利用イメージ

弊社内のサービスで障害が発生した場合の、Internal Status Pageの利用イメージは以下のとおりです（以下、サービスAで障害が発生したと仮定します）。

1. サービスAで障害が発生
2. 事業部ごとの監視ツールにて障害を検知、その情報をPageDutyに連携
3. PageDutyがXXXX
4. XXXX
5. Internal Status Page がサービスAを障害発生として表示
6. XXXX

上記のように、Internal Status Pageを利用することで、XXX

### 実装概要

DMMグループのSREチームは、グループ全体のサービス稼働状態を一元管理するInternal Status Pageを開発しました。このシステムは、サービスの健全性を監視し、問題が発生した際に迅速な通知を可能にするために設計されています。

#### 主要なコンポーネント

**DatadogとNewRelic:** サービスのパフォーマンス監視とアラート生成を担当します。これらのツールは、システムの健全性をリアルタイムで監視し、問題を検知した際には即座にPagerDutyへアラートを送信します。

**PagerDuty:** 監視ツールでのアラート状態をStatusPageに渡すためのハブ機能として利用します。

**StatusPage:** サービスの稼働状態を公開し、内部ステークホルダーに対して重要な情報を提供します。障害発生時にはStatusPageが最新のステータスを表示し、関係者が現状を把握できるようにします。

#### ワークフローの流れ

1. 監視: DatadogやNewRelicがサービスの異常を検知します。
2. アラート: 問題が発見されると、PagerDutyを通じてStatusPageにサービスのステータスが送信されます。
3. 通知: StatusPageが更新され、サービスの稼働状態が公開されます。
4. コミュニケーション: 既存の障害ワークフローを通じて作成されたSlackチャンネルを中心に、問題の解決に向けた協力が行われます。

#### 統合と協力

このシステムは、各事業部が独立して行っている監視活動を補完し、全社的な視点でのサービス監視とインシデント対応を可能にします。PagerDutyのService Directoryを利用することで、問い合わせ先の明確化と迅速な対応が実現されています。

この取り組みにより、DMMグループのサービス提供の信頼性は大幅に向上し、各チームの効率的なオペレーションが支援されています。

## 今後の展開

私たちのSREチームは、Internal Status Pageを中心としたサービス監視体系の継続的な改善に注力しています。以下は、今後の展開に関する主要な取り組みです。

### 現在と今後におけるアラート体系の強化

現在、PagerDutyを通じて最初の警告を行い、即座にStatusPageに情報を反映させる流れを確立しています。これにより、障害発生時の初動対応の迅速化を図っています。
今後、より詳細な分析と対応を目的とした通知体系を強化します。これにより、より深刻な問題や長期にわたる障害への対応を強化する計画です。

### インシデント管理プロセスの洗練

**インシデント対応:** ステータスページの役割を拡張し、インシデント管理機能を充実させることで、問題解決プロセスの透明性と効率を高めます。
**コミュニケーションの最適化:** Slackなどのコミュニケーションツールを活用し、インシデント発生時の社内コミュニケーションの流れを最適化します。これにより、関連する全てのチームが迅速に情報を共有し、協力して問題解決を行えるようにします。

### 監視と通知の精度向上

**メータリング:** システムの監視精度を向上させ、より精緻なデータに基づいたアラートを生成することで、予防的なメンテナンスと迅速な問題解決を実現します。
**通知のカスタマイズ:** 各チームのニーズに合わせたアラートのカスタマイズを進め、必要な情報だけが適切な人に届くようにします。

今後も、これらの取り組みを通じて、DMMグループのサービスが常に最高の状態で提供されるよう、SREチームは技術的な革新を続けていきます。

## 最後に
SRE部では仲間を募集しています！
大規模なサービスや新事業の立ち上げなど規模の大小、ジャンル・フェーズが存在する環境でSREを実践しませんか？



それでは皆さん良いクリスマスをお過ごしください〜



